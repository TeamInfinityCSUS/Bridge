<!-- DOCTYPE -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Bridge: Login</title>
    <meta charset="utf-8">
    <!-- Viewport Meta Tag -->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
      <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
      <script type="text/javascript">
        var inner; // This has to be here so all functions can access it
        $(document).ready(function(){ // Wait until page is ready
                  /* Skips log on screen and takes you directly to the home page if already logged in
                var profile_id = sessionStorage.getItem('profile_id');
                if (profile_id == null || profile_id == 0){
                        profile_id = 0;
                }else{
                        window.location.href = 'home.html'; // move to home page
                }
                */
                // The 4 button belows currently do nothing until admin log in built
                $("#logInBtn").click( function(){ if(confirm("Log?")){attemptlog()} } ); // When log on button is press
                $('#email').keyup( function(e){ if (e.keyCode === 13){ attemptlog() }; });  // When enter is press inside email
                $('#password').keyup( function(e){ if (e.keyCode === 13){ attemptlog() }; }); // When enter is press inside email
                $("#regBtn").click( function(){ // When register button is press
                        $("#container").load("stuff/fields.txt");
                        window.location.href = 'register.html'; // move to register
                });
                update(); // This causes the function update go live on refresh
        });
        function liveverify(num){ //runs when the verify button is clicked. Parameter = username from the table
                if( !confirm('Confirm verify of ' + inner[num] + '?') ){return;};
                $.post( "php/edit.php", { 'funct': 'verify', 'num': inner[num] }).done(update());
        }
        function liveedit(num){ //runs when the edit button is clicked. Parameter = username from the table
                //if( !confirm('Confirm edit of ' + inner[num] + '?') ){return;};
                $.post( "php/liveedit.php", { 'num': inner[num] }).done(function( data ){ // Hides search and table
                        document.getElementById('live table').style.display = 'none';
                        document.getElementById('searchbar').style.visibility = 'hidden';
                        document.getElementById('edittable').innerHTML = data;
                });
        }
        function livedelete(num){ //runs when the delete button is clicked. Parameter = username from the table
                if( !confirm('Confirm delete of ' + inner[num] + '?') ){return;};
                $.post( "php/edit.php", { 'funct': 'delete', 'num': inner[num] }).done(update());
        }
        function editing(num){ // This is the edit page. Parameter is 1 for accept and 0 for cancel
                if( num && !confirm('Apply Changes?') ){return;};
                $.post( "php/edit.php", { 'funct': 'edit', 'num': [$('#e1').val(),$('#e2').val(),$('#e3').val(),$('#e4').val(),$('#e5').val(),$('#e6').val()] }).done(update());
                document.getElementById('edittable').innerHTML = ""; // Unhide search and table
                document.getElementById('live table').style.display = 'block';
                document.getElementById('searchbar').style.visibility = 'visible';
        }
        function attemptlog(){ // attempts to log in. Purely for verification. Not used, yet.
                $.post( "php/log.php", { 'log': [$('#email').val(), $('#password').val()] }).done(function( data ) {
                        if (data==0){ // log
                                email_label = 'Email Address' // Original label with added error label
                                document.getElementById('email_label').innerHTML = email_label + ' Incorrect password or username'.fontcolor("red").fontsize(1);
                                $('#password').val("");    // clears password if incorrect
                        }else{
                                sessionStorage.setItem('profile_id',data); // saves the profile_id in sessionStorage for the next page
                                alert("Profile Login: " + $('#email').val()); // which user profile will be loaded
                                window.location.href = 'home.html'; // move to home page
                        }
                });
        }
        function update(){ // Updates the live search table whenever something appears in the search box
                var prepend = '<table class="table table-hover"><thead><tr><th>Username</th><th>Email</th><th>First Name</th><th>Last Name</th><th>Account Type</th><th>Verfied</th><th></th></tr></thead><tbody>';
                var postpend = '</tbody></table>';
                $.post("php/livesearch.php", { 'search' : [$('#searchby').val(),$('#searchinput').val()] }).done(function(data){
                        var out = $.parseJSON(data);
                        inner = out.outlisting;
                        document.getElementById('live table').innerHTML = prepend + out.outstring + postpend;
                });
        }
      </script>
  </head>
  <body>
        <h1>Bridge</h1>
        <div class="row"></div>

        <div class="row loginblock">
        <div class = "col-lg-2 col-md-2 col-sm-1 col-xs-12"></div>
        <div class = "col-lg-8 col-md-8 col-sm-10 col-xs-12">

        <div class="container data" id="container">

<form>
  <div class="input-group" id="searchbar">
    <select id="searchby">
        <option value = "username">By Username</option>
        <option value = "email">By Email</option>
        <option value = "fname">By First Name</option>
        <option selected value = "lname">By Last Name</option>
        <option value = "acc_type">By Account</option>
        <option value = "is_verified">By Verified</option>
   </select>
    <input type="text" class="form-control" placeholder="Search" size="10" onkeyup="update(this.value)" id="searchinput">
  </div>
</form>
<div id="live table">
<table class="table table-hover">
    <thead>
      <tr>
        <th>Last name</th>
        <th>First name</th>
        <th>Email</th>
        <th>Username</th>
        <th>Account Type</th>
        <th>Verfied</th>
        <th></th>
      </tr>
    </thead>
    <tbody>

    </tbody>
</table>
</div>
<div id="edittable"></div>
        </div>

        <div class = "col-lg-2 col-md-2 col-sm-1 col-xs-12"></div>
        </div>
        <div class="row"></div>
        <style>
        h1{
                background-color: #1A7CBC;
        }
        body{
                background-color: #82CBFB;
        }
        loginblock{
                margin: auto;
        }
    password{
                padding: 20px;
        }
        </style>

    <!-- JavaScript: placed at the end of the document so the pages load faster -->
                <!-- jQuery library -->
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
                <!-- Popper -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>

                <!-- Latest compiled and minified Bootstrap JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
  </body>
</html>